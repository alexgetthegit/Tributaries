import * as THREE from 'https://unpkg.com/three@0.160.0/build/three.module.js';
import { OrbitControls } from 'https://unpkg.com/three@0.160.0/examples/jsm/controls/OrbitControls.js';
import { GLTFLoader } from 'https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js';

// setup renderer, scene, camera, controls first...

const loader = new GLTFLoader();

const GLB_URL = 'https://pub-8cbedf6f909d4e39a938e2cee5080e7a.r2.dev/drone_scene_2025-09-19_metashape250_decimated.glb';

loader.load(
  GLB_URL,
  (gltf) => {
    console.log('✅ Loaded GLB');
    const model = gltf.scene;
    scene.add(model);

    // Center and ground the model
    const box = new THREE.Box3().setFromObject(model);
    const center = box.getCenter(new THREE.Vector3());
    const size = box.getSize(new THREE.Vector3());

    model.position.sub(center);           // center at origin
    model.position.y -= box.min.y;        // sit on ground

    // Move camera back a bit
    const dist = size.length() / (2 * Math.tan(THREE.MathUtils.degToRad(camera.fov)/2));
    camera.position.set(dist, dist * 0.5, dist);
    controls.target.set(0, size.y * 0.5, 0);
    controls.update();
  },
  (xhr) => {
    if (xhr.total) {
      console.log(`Loading: ${(xhr.loaded / xhr.total * 100).toFixed(1)}%`);
    }
  },
  (error) => {
    console.error('❌ GLB load failed', error);
  }
);
